// code generated using pythonref/generate_deprecated_falcon_epervier_test_vectors.py.
pragma solidity ^0.8.25;

import {Test, console} from "forge-std/Test.sol";
import "../../src/ZKNOX_NTT.sol";
import "../../src/deprecated/ZKNOX_falcon_epervier_old.sol";

contract ZKNOX_falcon_epervierTest is Test {
    ZKNOX_falcon_epervier epervier;
    //exemple of stateless initialisation, no external contract provided
    ZKNOX_NTT ntt = new ZKNOX_NTT(address(0), address(0), 12289, 12265);
    // forgefmt: disable-next-line
        uint256[512] psi_rev = [uint256(1), 10810, 7143, 4043, 10984, 722, 5736, 8155, 3542, 8785, 9744, 3621, 10643, 1212, 3195, 5860, 7468, 2639, 9664, 11340, 11726, 9314, 9283, 9545, 5728, 7698, 5023, 5828, 8961, 6512, 7311, 1351, 2319, 11119, 11334, 11499, 9088, 3014, 5086, 10963, 4846, 9542, 9154, 3712, 4805, 8736, 11227, 9995, 3091, 12208, 7969, 11289, 9326, 7393, 9238, 2366, 11112, 8034, 10654, 9521, 12149, 10436, 7678, 11563, 1260, 4388, 4632, 6534, 2426, 334, 1428, 1696, 2013, 9000, 729, 3241, 2881, 3284, 7197, 10200, 8595, 7110, 10530, 8582, 3382, 11934, 9741, 8058, 3637, 3459, 145, 6747, 9558, 8357, 7399, 6378, 9447, 480, 1022, 9, 9821, 339, 5791, 544, 10616, 4278, 6958, 7300, 8112, 8705, 1381, 9764, 11336, 8541, 827, 5767, 2476, 118, 2197, 7222, 3949, 8993, 4452, 2396, 7935, 130, 2837, 6915, 2401, 442, 7188, 11222, 390, 773, 8456, 3778, 354, 4861, 9377, 5698, 5012, 9808, 2859, 11244, 1017, 7404, 1632, 7205, 27, 9223, 8526, 10849, 1537, 242, 4714, 8146, 9611, 3704, 5019, 11744, 1002, 5011, 5088, 8005, 7313, 10682, 8509, 11414, 9852, 3646, 6022, 2987, 9723, 10102, 6250, 9867, 11224, 2143, 11885, 7644, 1168, 5277, 11082, 3248, 493, 8193, 6845, 2381, 7952, 11854, 1378, 1912, 2166, 3915, 12176, 7370, 12129, 3149, 12286, 4437, 3636, 4938, 5291, 2704, 10863, 7635, 1663, 10512, 3364, 1689, 4057, 9018, 9442, 7875, 2174, 4372, 7247, 9984, 4053, 2645, 5195, 9509, 7394, 1484, 9042, 9603, 8311, 9320, 9919, 2865, 5332, 3510, 1630, 10163, 5407, 3186, 11136, 9405, 10040, 8241, 9890, 8889, 7098, 9153, 9289, 671, 3016, 243, 6730, 420, 10111, 1544, 3985, 4905, 3531, 476, 49, 1263, 5915, 1483, 9789, 10800, 10706, 6347, 1512, 350, 10474, 5383, 5369, 10232, 9087, 4493, 9551, 6421, 6554, 2655, 9280, 1693, 174, 723, 10314, 8532, 347, 2925, 8974, 11863, 1858, 4754, 3030, 4115, 2361, 10446, 2908, 218, 3434, 8760, 3963, 576, 6142, 9842, 1954, 10238, 9407, 10484, 3991, 8320, 9522, 156, 2281, 5876, 10258, 5333, 3772, 418, 5908, 11836, 5429, 7515, 7552, 1293, 295, 6099, 5766, 652, 8273, 4077, 8527, 9370, 325, 10885, 11143, 11341, 5990, 1159, 8561, 8240, 3329, 4298, 12121, 2692, 5961, 7183, 10327, 1594, 6167, 9734, 7105, 11089, 1360, 3956, 6170, 5297, 8210, 11231, 922, 441, 1958, 4322, 1112, 2078, 4046, 709, 9139, 1319, 4240, 8719, 6224, 11454, 2459, 683, 3656, 12225, 10723, 5782, 9341, 9786, 9166, 10542, 9235, 6803, 7856, 6370, 3834, 7032, 7048, 9369, 8120, 9162, 6821, 1010, 8807, 787, 5057, 4698, 4780, 8844, 12097, 1321, 4912, 10240, 677, 6415, 6234, 8953, 1323, 9523, 12237, 3174, 1579, 11858, 9784, 5906, 3957, 9450, 151, 10162, 12231, 12048, 3532, 11286, 1956, 7280, 11404, 6281, 3477, 6608, 142, 11184, 9445, 3438, 11314, 4212, 9260, 6695, 4782, 5886, 8076, 504, 2302, 11684, 11868, 8209, 3602, 6068, 8689, 3263, 6077, 7665, 7822, 7500, 6752, 4749, 4449, 6833, 12142, 8500, 6118, 8471, 1190, 9606, 3860, 5445, 7753, 11239, 5079, 9027, 2169, 11767, 7965, 4916, 8214, 5315, 11011, 9945, 1973, 6715, 8775, 11248, 5925, 11271, 654, 3565, 1702, 1987, 6760, 5206, 3199, 12233, 6136, 6427, 6874, 8646, 4948, 6152, 400, 10561, 5339, 5446, 3710, 6093, 468, 8301, 316, 11907, 10256, 8291, 3879, 1922, 10930, 6854, 973, 11035];

    // forgefmt: disable-next-line
        uint256[512] psi_inv_rev = [uint256(1), 1479, 8246, 5146, 4134, 6553, 11567, 1305, 6429, 9094, 11077, 1646, 8668, 2545, 3504, 8747, 10938, 4978, 5777, 3328, 6461, 7266, 4591, 6561, 2744, 3006, 2975, 563, 949, 2625, 9650, 4821, 726, 4611, 1853, 140, 2768, 1635, 4255, 1177, 9923, 3051, 4896, 2963, 1000, 4320, 81, 9198, 2294, 1062, 3553, 7484, 8577, 3135, 2747, 7443, 1326, 7203, 9275, 3201, 790, 955, 1170, 9970, 5374, 9452, 12159, 4354, 9893, 7837, 3296, 8340, 5067, 10092, 12171, 9813, 6522, 11462, 3748, 953, 2525, 10908, 3584, 4177, 4989, 5331, 8011, 1673, 11745, 6498, 11950, 2468, 12280, 11267, 11809, 2842, 5911, 4890, 3932, 2731, 5542, 12144, 8830, 8652, 4231, 2548, 355, 8907, 3707, 1759, 5179, 3694, 2089, 5092, 9005, 9408, 9048, 11560, 3289, 10276, 10593, 10861, 11955, 9863, 5755, 7657, 7901, 11029, 11813, 8758, 7384, 8304, 10745, 2178, 11869, 5559, 12046, 9273, 11618, 3000, 3136, 5191, 3400, 2399, 4048, 2249, 2884, 1153, 9103, 6882, 2126, 10659, 8779, 6957, 9424, 2370, 2969, 3978, 2686, 3247, 10805, 4895, 2780, 7094, 9644, 8236, 2305, 5042, 7917, 10115, 4414, 2847, 3271, 8232, 10600, 8925, 1777, 10626, 4654, 1426, 9585, 6998, 7351, 8653, 7852, 3, 9140, 160, 4919, 113, 8374, 10123, 10377, 10911, 435, 4337, 9908, 5444, 4096, 11796, 9041, 1207, 7012, 11121, 4645, 404, 10146, 1065, 2422, 6039, 2187, 2566, 9302, 6267, 8643, 2437, 875, 3780, 1607, 4976, 4284, 7201, 7278, 11287, 545, 7270, 8585, 2678, 4143, 7575, 12047, 10752, 1440, 3763, 3066, 12262, 5084, 10657, 4885, 11272, 1045, 9430, 2481, 7277, 6591, 2912, 7428, 11935, 8511, 3833, 11516, 11899, 1067, 5101, 11847, 9888, 1254, 11316, 5435, 1359, 10367, 8410, 3998, 2033, 382, 11973, 3988, 11821, 6196, 8579, 6843, 6950, 1728, 11889, 6137, 7341, 3643, 5415, 5862, 6153, 56, 9090, 7083, 5529, 10302, 10587, 8724, 11635, 1018, 6364, 1041, 3514, 5574, 10316, 2344, 1278, 6974, 4075, 7373, 4324, 522, 10120, 3262, 7210, 1050, 4536, 6844, 8429, 2683, 11099, 3818, 6171, 3789, 147, 5456, 7840, 7540, 5537, 4789, 4467, 4624, 6212, 9026, 3600, 6221, 8687, 4080, 421, 605, 9987, 11785, 4213, 6403, 7507, 5594, 3029, 8077, 975, 8851, 2844, 1105, 12147, 5681, 8812, 6008, 885, 5009, 10333, 1003, 8757, 241, 58, 2127, 12138, 2839, 8332, 6383, 2505, 431, 10710, 9115, 52, 2766, 10966, 3336, 6055, 5874, 11612, 2049, 7377, 10968, 192, 3445, 7509, 7591, 7232, 11502, 3482, 11279, 5468, 3127, 4169, 2920, 5241, 5257, 8455, 5919, 4433, 5486, 3054, 1747, 3123, 2503, 2948, 6507, 1566, 64, 8633, 11606, 9830, 835, 6065, 3570, 8049, 10970, 3150, 11580, 8243, 10211, 11177, 7967, 10331, 11848, 11367, 1058, 4079, 6992, 6119, 8333, 10929, 1200, 5184, 2555, 6122, 10695, 1962, 5106, 6328, 9597, 168, 7991, 8960, 4049, 3728, 11130, 6299, 948, 1146, 1404, 11964, 2919, 3762, 8212, 4016, 11637, 6523, 6190, 11994, 10996, 4737, 4774, 6860, 453, 6381, 11871, 8517, 6956, 2031, 6413, 10008, 12133, 2767, 3969, 8298, 1805, 2882, 2051, 10335, 2447, 6147, 11713, 8326, 3529, 8855, 12071, 9381, 1843, 9928, 8174, 9259, 7535, 10431, 426, 3315, 9364, 11942, 3757, 1975, 11566, 12115, 10596, 3009, 9634, 5735, 5868, 2738, 7796, 3202, 2057, 6920, 6906, 1815, 11939, 10777, 5942, 1583, 1489, 2500, 10806, 6374, 11026, 12240];

    //stateful initialisation
    function setUp() public {
        bytes memory bytecode_psirev = abi.encodePacked(psi_rev);

        address a_psirev; //address of the precomputations bytecode contract
        a_psirev = address(uint160(0xcaca)); //here it is etched, use create in the future
        vm.etch(a_psirev, bytecode_psirev); //pushing psirev bytecode into contract todo : replace with create

        bytes memory bytecode_psiInvrev = abi.encodePacked(psi_inv_rev);

        address a_psiInvrev; //address of the precomputations bytecode contract
        a_psiInvrev = address(uint160(0xa5a5)); //here it is etched, use create in the future
        vm.etch(a_psiInvrev, bytecode_psiInvrev); //pushing psirev bytecode into contract todo : replace with create

        ntt.update(a_psirev, a_psiInvrev, 12289, 12265); //update ntt with outer contract

        epervier = new ZKNOX_falcon_epervier(ntt);
    }

    function testVector0() public view {
        // public key
        // forgefmt: disable-next-line
        address pk_0 = address(728199263750570446964354330903202655824594974439);

        // signature s1
        // forgefmt: disable-next-line
        uint[512] memory tmp_s1 = [uint(12097), 37,17,12153,12241,95,12134,12172,188,12277,12219,12186,118,12136,154,12136,12178,11,175,12041,9,15,12246,93,12181,12190,12285,359,21,411,96,12224,12209,81,136,257,96,115,12244,12038,50,12058,17,12150,292,224,12129,37,12202,12037,12120,12209,11877,124,12246,92,12087,12221,7,12117,11977,12048,71,193,12054,12110,8,38,88,172,29,138,159,50,56,12265,85,43,218,12288,34,157,196,79,245,12047,109,402,12181,12120,20,12193,264,12123,12180,11,139,12262,12214,87,12241,12003,158,12170,169,9,181,1,12227,12157,12174,11995,5,12082,12276,146,12263,32,12241,90,116,12123,300,295,12198,66,12237,11962,12104,260,173,153,12214,58,71,73,91,134,11831,12097,350,250,12077,12124,12284,12237,12171,12207,427,302,12273,201,12238,175,12274,74,12223,117,12175,12060,111,12156,241,12095,71,154,12253,107,11929,18,186,12020,65,12102,48,0,12256,12140,40,12210,12111,12157,12077,214,209,12148,166,123,129,11,12220,12130,12146,12259,12121,224,257,12072,60,12260,74,31,93,32,12170,12152,12280,147,12233,12213,110,12158,12062,12161,12176,11950,270,12051,111,49,12269,12043,12196,12139,12234,65,12284,12104,61,310,12272,274,146,12235,12226,92,36,11874,11950,263,228,34,6,12238,87,12087,12082,49,93,12281,12232,179,12284,12206,202,12118,12101,22,41,12260,12164,131,77,12195,12026,11955,12285,20,12128,12076,12252,12036,19,130,12236,12057,12072,12249,2,12012,12285,234,85,27,14,12230,222,98,12095,12272,12012,12102,12188,94,12263,12163,12268,12255,5,12262,12142,12170,167,12135,196,357,87,169,12146,112,12267,371,12241,221,12164,5,12167,126,12205,12046,64,12017,12241,127,217,388,12238,306,12106,47,152,34,37,12149,6,137,212,12101,12285,12216,77,12151,255,0,282,237,14,12165,262,63,165,12281,12288,12002,12034,12266,101,0,12140,12153,12074,12,137,12171,238,235,11982,12177,57,146,361,12193,221,12065,204,162,79,12163,12205,11935,60,12241,12162,12171,29,158,11951,21,146,11987,12242,68,12284,385,201,12148,260,158,12203,216,83,12144,12213,167,12238,246,12254,32,16,12266,12241,12229,262,231,44,12190,12136,273,12210,12185,100,215,12178,449,12155,11969,168,60,26,12188,12221,188,12143,12089,32,271,12158,106,12077,12286,35,183,85,12209,155,147,12099,11976,12220,7,98,12222,12093,166,39,199,12197,1,38,178,12147,127,154,196,309,22,72,12157,165,453,192,140,101,47,12229,12104,12172,12249,26,203,11865,12,129,88,1,12158,12256,12084,12176,3,12146,12166,12002,218,37,290,12048,111,254,12055,12103,12053,244,12139,12189,12048,11981,21,241,93,12254,97];

        // signature s2
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2 = [uint(271), 204,12288,28,237,12212,12221,12221,12059,12277,12112,12201,30,12077,124,218,213,85,12049,12264,12179,12116,12118,16,12213,378,81,27,12196,149,228,103,37,219,12263,12232,167,12104,27,74,12207,50,12271,11895,12137,93,12190,12265,12092,278,118,12083,12150,11905,12140,62,86,11954,194,8,180,57,265,70,346,12279,12213,12174,28,125,12162,12061,94,12217,70,12031,178,12256,12149,12231,12116,12148,12038,12284,212,12151,124,236,12136,12259,122,12016,12190,12271,12197,12286,50,17,126,12169,12188,12286,252,12005,12241,146,147,12175,139,92,117,12144,12196,47,12182,12139,12226,12252,12280,12104,216,209,80,132,18,174,48,12131,177,238,12177,41,295,11,12242,110,38,230,12198,12116,12227,245,150,12138,294,12156,12158,12079,12241,313,56,12179,12246,12134,364,12253,87,32,260,12142,12129,107,12221,215,12256,12058,286,12198,12257,12106,12285,12117,11,28,157,82,12159,12079,47,12011,12155,12279,371,12191,12152,12230,12261,12105,12060,12046,127,12164,12187,12099,12127,12086,12103,12265,100,126,12235,12288,12044,12260,12188,86,12135,12265,55,120,168,85,243,12266,201,247,78,12174,43,12273,88,24,104,361,12152,11,52,128,79,12165,168,11964,12190,12201,12180,186,12195,188,12201,80,239,12103,12057,34,12261,54,312,12223,12187,12278,16,156,12147,47,12087,12178,12274,267,63,12180,83,16,65,12254,19,12062,12240,12184,12204,14,12147,12155,86,12217,23,84,12220,12143,12096,112,115,12230,12173,12150,12171,12244,309,272,12223,101,117,12140,14,12175,112,140,12270,12266,12193,128,147,273,264,500,12035,50,11962,12118,169,12115,3,12160,194,56,12128,274,116,138,18,155,186,11992,12161,74,12068,107,12176,12237,12229,261,222,90,246,77,12220,161,12264,12231,146,158,165,259,6,12216,12237,12278,28,68,12162,12189,12176,12243,12160,25,54,12132,102,63,12134,12058,111,11992,111,12174,179,95,12284,12283,66,12257,12129,12032,12164,12119,12196,12186,56,178,12242,12206,12256,12044,22,6,158,15,64,12040,147,288,12241,340,12092,15,22,11964,12046,94,12271,12173,11974,11,12193,12132,129,44,12222,12123,74,12161,167,12181,11865,23,101,21,276,12126,118,12264,12234,22,315,12063,12063,12206,12132,287,118,12170,12202,12229,12141,152,166,12119,11946,174,12246,11972,12122,17,12024,365,49,12159,149,12244,148,51,223,12022,12052,59,75,114,12083,25,12210,90,193,66,12284,12115,114,1,12131,12219,12186,135,12173,12220,12031,167,12184,159,142,12081,12236,12249,12147,12136,0,12030,18,252,108,10,225,11850,186,183,35,12108,12036,126,98,12039,25,12169,12214,2,12268,183,12231,12166,257,143,12251,43,127,143];

        ZKNOX_falcon_epervier.Signature memory sig;
        // signature s2 inverse ntt
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2_inv_ntt = [uint(8369), 5980,8958,3308,1777,2594,5837,281,7236,8182,635,10806,556,11085,10632,2591,1648,6724,6674,1050,10198,1183,7645,2863,10994,9842,9689,5473,10237,1625,7127,4507,8195,2417,943,39,5780,10493,9558,3521,8686,3849,2341,5276,4471,12189,7515,1889,7612,11430,4071,5677,5352,3351,11573,4445,5861,12030,1997,5130,2613,10306,4461,275,6585,2878,5937,6891,6755,3437,1277,8943,2860,10968,11483,3364,1588,11767,437,11565,6776,1893,247,6017,3817,3438,10913,5347,9569,9829,11941,3183,738,6291,9506,8744,9365,9041,4245,11876,1488,5127,1416,8555,11328,6366,5932,2810,1231,11021,1525,3552,186,10800,4397,2115,12095,2186,10441,8311,7383,4864,711,10427,8579,2992,1210,10052,7190,6447,4199,9871,1985,4507,2600,8223,9082,1530,8759,5859,5518,2658,1078,2701,11369,5634,8259,7017,1333,3896,11607,4621,8407,6330,11160,2503,769,1583,9188,7386,2212,4296,11050,12277,5589,3577,1602,4695,5846,5622,1818,11378,8297,11964,237,2729,6917,969,2043,1631,6447,6403,5684,9631,6928,9372,91,1368,9158,4331,12145,11052,476,1120,1212,7843,6779,4284,6282,5416,897,2535,143,11236,10722,5624,4721,8242,2923,6984,3091,7598,10904,2458,10885,10101,3385,4084,7398,8955,1883,5624,8592,7018,10737,5587,5829,5043,4651,3720,6104,3426,11164,8044,9557,9954,8834,6824,7212,7216,11916,4047,4797,10074,4267,9929,835,6535,7892,8542,11808,7471,10206,9314,4166,6921,11526,4832,12189,3253,6377,7009,94,5590,5033,10444,11650,3191,3992,3305,10423,7084,11776,8470,10856,1189,4828,4347,3232,9295,6416,4456,1374,1831,4898,787,4503,8407,915,6233,937,6628,2042,9142,8717,11468,1027,10512,2961,1741,11860,2771,12037,7820,6453,6402,9998,11474,10979,7069,4986,2153,4837,109,7709,6965,3840,5822,7873,2465,3785,4902,10602,4872,7660,3194,11989,471,4335,5960,367,1546,9747,10948,8484,11693,39,10723,12205,616,1029,9506,10693,8551,4409,7337,7311,9949,841,387,10638,3627,7434,4907,6721,6216,5109,2761,2407,5249,9088,4728,6369,2116,1414,2192,9913,10162,8533,8126,6667,3335,8711,6287,12037,2334,10730,3781,4753,12030,2242,2734,2489,11893,8867,4275,9644,950,6993,9263,7599,9794,10292,4715,2374,8699,9720,10336,6492,8841,11826,4133,1489,6889,9614,10495,1629,2242,4531,1190,10739,10874,6816,9342,6383,285,9612,7861,4583,3309,279,4157,397,9279,12075,12086,2083,4189,6750,295,10013,3352,1264,7422,9340,1742,1423,10292,1010,2878,8193,4881,10353,9491,9336,4169,4980,1940,9629,4282,6004,4617,1934,11796,8667,218,6055,7806,2487,1523,5796,5544,11318,5242,3030,5856,10891,10177,1093,3624,438,4420,879,7265,10978,5900,5088,3123,6479,4294,6103,12047,619,10590,7802,5377,9309,11829,4644,3486,2466,9347,8905,12052,6750,181,2142,9655,7367,12033,10577,3543,10219,8803,8698,10174,3983,2933,2714,1488,11095,5986];
        for (uint256 i = 0; i < 512; i++) {
            sig.s1[i] = tmp_s1[i];
            sig.s2[i] = tmp_s2[i];
            sig.hint[i] = tmp_s2_inv_ntt[i];
        }
        // message
        bytes memory message = "My name is Renaud";
        sig.salt =
            "\xab\x0b\xae\x31\x63\x39\x89\x43\x04\xe3\x58\x77\xb0\xc2\x8a\x9b\x1f\xd1\x66\xc7\x96\xb9\xcc\x25\x8a\x06\x4a\x8f\x57\xe2\x7f\x2a\x5b\x8d\x54\x8a\x72\x8c\x94\x44";
        address recovered_pk_0;
        recovered_pk_0 = epervier.recover(message, sig, false);
        assertEq(pk_0, recovered_pk_0);
    }

    function testVector1() public view {
        // public key
        // forgefmt: disable-next-line
        address pk_1 = address(728199263750570446964354330903202655824594974439);

        // signature s1
        // forgefmt: disable-next-line
        uint[512] memory tmp_s1 = [uint(12251), 164,12179,12260,95,12070,12056,12261,12194,415,409,234,12112,6,309,163,148,12235,27,12130,12048,12228,67,12178,174,12285,12247,275,123,12206,7,12167,418,12278,236,123,7,12176,185,12047,24,12065,433,12257,236,167,23,12173,62,210,12206,137,12231,12154,11,12279,13,12209,12203,12117,12004,12211,101,20,194,6,24,64,27,5,3,11896,12221,380,3,82,65,576,12094,179,12208,273,12018,177,12047,304,12029,18,12170,12022,377,12246,12222,127,12170,12132,104,64,12242,12256,11891,143,12265,12244,154,12229,72,11952,81,326,12093,12096,12090,79,10,12268,84,306,12228,56,16,228,12153,123,203,26,10,32,312,40,12236,12066,218,12258,146,127,244,56,51,77,12262,61,9,57,11998,204,12231,146,11,13,12270,12157,55,12165,12184,276,110,66,249,224,12281,318,248,12128,12252,12285,296,12281,12155,12229,92,125,12067,12044,177,46,56,35,12103,40,12247,28,12269,115,89,228,12134,12162,12051,12230,12177,42,12215,177,12152,154,144,12100,153,62,12,219,90,170,171,199,303,12247,12196,12267,12209,16,12174,75,12065,257,12099,208,53,12099,44,12262,253,12239,12054,12267,12229,12240,11765,88,134,12212,81,106,277,36,12288,12155,181,12204,245,228,20,38,171,142,12029,6,12196,85,12216,11977,12258,149,98,61,12197,12195,12275,12116,12078,216,41,12280,216,11703,12223,12005,95,12195,211,11,179,11951,12172,12236,177,12262,64,38,201,12157,12246,424,82,153,12202,239,90,116,111,37,12192,164,141,12193,12187,127,12205,12183,77,33,12135,11,174,12181,111,12109,101,12175,12208,12276,12104,135,12164,365,200,12138,94,79,12204,266,50,21,168,12234,12222,81,12254,12262,146,12248,132,259,118,11985,12114,12185,12272,293,55,12251,49,12242,129,12065,13,12222,86,12143,191,117,5,11921,12025,12285,12237,12286,12142,12231,12062,113,3,77,12064,12159,53,46,12241,93,12201,12123,130,11966,15,226,231,113,12101,12216,12275,12210,231,155,11861,12182,2,238,12082,12272,17,80,12276,12261,177,12271,12007,12111,12123,84,9,131,12202,172,12125,12,8,12150,25,269,12124,12088,141,12169,45,57,12286,12203,12204,12279,12270,12095,12255,12150,11737,151,12171,12231,33,11925,249,265,12139,136,80,12165,193,12104,12250,12260,11999,12232,43,12194,12155,12184,276,12225,12124,12255,11993,78,324,12219,12218,41,113,12041,12263,12103,212,12052,197,7,12017,27,12203,12166,12086,343,77,11929,12194,33,202,12227,12092,202,48,1,61,12207,12204,14,3,196,91,206,12286,12213,12148,2,12171,12077,12249,119,12216,93,139,12155,11929,12222,107,86,38,12109,12134,12255,65,146,12192,12164];

        // signature s2
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2 = [uint(65), 12196,12269,13,12173,97,79,12223,12245,12144,225,11936,12167,11969,12261,71,49,109,12147,70,11977,12167,41,33,12243,12213,12239,12134,120,12190,12236,12070,10,48,12282,225,321,23,12010,175,12213,142,54,24,201,92,197,12109,12244,180,5,12238,418,73,242,12243,75,44,34,22,12283,166,55,11998,385,101,309,11974,11962,12286,230,12120,352,11992,35,12029,32,12214,458,208,116,12125,11876,224,12180,64,12091,12162,12032,12171,354,12116,12254,307,12013,51,18,12186,27,12223,12217,120,148,12243,12255,12244,92,168,12201,12147,11999,12224,56,12220,12222,12227,61,176,62,12065,357,179,46,12157,12223,247,35,12180,84,12231,12174,12074,32,12028,12093,12279,12266,372,12212,135,12095,118,12237,12091,12283,12219,193,6,58,12179,375,4,107,12227,12269,12170,192,122,206,90,12095,156,12020,12206,12263,151,12110,212,172,80,11986,40,154,213,12279,12243,12101,146,125,5,2,347,12049,12279,37,161,12118,12224,12199,77,160,12197,24,65,124,12002,12230,96,12106,12016,367,12197,215,32,75,125,58,12043,343,150,12137,12142,407,177,12275,124,362,12203,12206,333,12228,12085,444,54,12119,12251,11994,12,11904,61,12250,12167,12082,11953,11958,143,12038,122,113,12029,87,12230,174,12248,109,7,438,28,12237,96,223,98,246,12243,12166,82,12244,137,12006,12048,12216,103,200,12166,12,30,12230,184,152,369,12058,44,12281,97,12248,49,12271,12095,12217,461,11968,12161,12121,145,12228,12094,142,112,12081,217,74,12205,178,242,11986,12215,348,17,12112,94,12274,12273,12107,152,12260,12209,58,52,12219,12277,12208,66,12142,44,12189,12206,12167,12184,120,23,12136,11892,42,12155,12237,113,221,12265,12032,12223,70,54,12224,178,12079,87,12161,125,37,82,85,11975,225,12006,12268,113,90,458,12104,12217,12144,12285,93,12038,184,12240,12191,12234,12136,33,12155,176,12287,12262,92,12016,12123,33,417,12262,146,12246,12263,12159,184,12253,158,23,78,82,12256,12285,12235,12070,12050,12094,12191,12125,115,20,210,12225,61,12238,221,62,12092,36,1,188,26,52,12126,12256,12220,85,12207,12043,72,124,12226,462,78,12176,49,301,63,12045,12153,12170,12092,12127,11813,204,11947,12210,12188,204,11880,262,12132,93,12279,21,46,12141,156,80,12015,287,12200,11987,11932,0,12229,80,11843,12181,31,12211,49,12155,12173,12261,12149,96,12180,264,12136,12063,126,224,12215,88,12169,12250,98,136,12226,12152,76,12039,202,120,379,12260,35,271,12192,12243,25,12271,12102,138,12228,12287,12100,21,234,12220,12260,12168,12150,12270,11995,260,193,284,251,12088,12240,12084,12275,12089,12124,12047,12288,135,145,12287,12079,1];

        ZKNOX_falcon_epervier.Signature memory sig;
        // signature s2 inverse ntt
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2_inv_ntt = [uint(1986), 1440,7666,11626,3256,1360,2272,5579,7902,5845,2654,11703,6791,4350,2653,4957,10383,328,4046,982,5998,6965,8981,5784,7346,5279,9677,11968,4996,6075,6264,7671,10763,5718,6526,2692,11973,74,11007,6593,5122,7274,2706,8557,2723,9379,4657,4133,9034,8289,11579,10291,9587,7549,11379,9694,9199,9523,2291,11407,4930,10484,7163,1077,817,5644,10824,9205,9824,11304,3909,1594,2190,9605,8076,1148,2564,578,466,11606,7437,265,9448,238,311,9307,5206,6336,199,71,6150,10188,10484,3831,8436,5564,7597,9834,4309,2095,228,3633,795,5088,8274,11637,3739,8807,12080,3086,11253,10009,10999,5321,8625,125,10237,9841,11795,5055,4801,5897,10763,8216,4925,10363,6150,12175,8921,11636,4329,5389,10622,4536,6882,2610,6778,11742,11779,9285,9868,4957,6065,2516,11430,11647,6161,7691,5991,12127,10871,7077,7052,11822,8448,3195,9103,1773,1331,4558,7146,8386,7210,496,3175,3813,10205,6623,7451,68,7032,4146,951,4641,7391,3078,2262,4796,1999,5313,4520,5468,7882,12135,4181,9569,6562,8453,11352,1764,12179,2834,7922,1947,8578,11965,10385,3266,2482,9772,753,2237,3854,1701,11477,7246,4608,8769,5185,2806,3844,5567,2461,11022,9513,3103,7632,10777,6003,1162,4872,10967,563,3449,938,3411,6953,2169,11444,280,695,7471,3981,2749,3563,3823,2192,8759,4854,11489,9645,4080,3748,2812,10871,6069,8823,9302,5710,5474,7444,547,5273,9423,11219,6974,9074,9354,5287,5400,7425,3418,8871,11954,8906,849,8727,4141,6004,395,2960,4740,6632,4319,3773,5522,3196,4257,298,5183,9151,627,4596,5580,6104,3556,8405,4615,6126,5010,2095,8283,2931,3267,4213,3846,11953,3168,11959,11623,12199,368,4095,10514,4048,5361,11968,4548,810,4,11448,2116,4893,6613,11217,3223,7997,4014,3599,11111,3710,2606,8176,8198,11530,1239,7231,3579,2086,8076,883,6508,2798,906,9681,5345,11062,638,4811,9808,272,676,8842,407,7502,9462,4068,11887,10076,7337,11568,10010,1056,7468,6487,8210,5553,8848,9571,5215,3983,7393,11484,6010,6478,964,8596,10410,5051,2831,7474,10870,6679,3784,10885,452,5400,3898,3177,11911,6371,9467,8269,5707,7512,494,6438,9067,10182,7765,8470,5300,11709,4703,10218,605,2339,2703,9918,5848,338,474,5315,3890,11850,8821,6708,879,1426,6205,7017,11710,12230,906,304,188,7305,1483,389,8092,4820,5190,7538,4980,11566,3251,1778,3967,5122,11027,2666,1849,8068,7497,6779,5991,11457,6250,11144,7832,2929,8176,6476,2851,9982,6984,6620,12099,12158,11375,4599,3788,6485,2602,102,5411,9462,12076,3801,8581,9619,769,3478,8574,10241,1928,7687,11524,4336,3395,8225,6589,3474,12255,8815,6620,2607,8072,4909,958,10328,5686,4398,7460,10583,486,1545,1337,11795,8996,5988,724,6819,9085,670,12099,2763,4983,7750,5100,2934,10476,1117,9924,8927,2321,6406,8438,4991,6449,6152,10624];
        for (uint256 i = 0; i < 512; i++) {
            sig.s1[i] = tmp_s1[i];
            sig.s2[i] = tmp_s2[i];
            sig.hint[i] = tmp_s2_inv_ntt[i];
        }
        // message
        bytes memory message = "My name is Simon";
        sig.salt =
            "\x91\x89\x90\xff\x93\xe0\x65\x6b\x5f\x75\xb0\x87\x29\xc6\x0e\x6a\x9d\x73\x52\xb9\xef\xd2\xe3\x3e\x3d\x1b\xa6\xe6\xd8\x9e\xdf\xa6\x71\x26\x6e\xce\x6b\xe7\xbb\x5a";
        address recovered_pk_1;
        recovered_pk_1 = epervier.recover(message, sig, false);
        assertEq(pk_1, recovered_pk_1);
    }

    function testVector2() public view {
        // public key
        // forgefmt: disable-next-line
        address pk_2 = address(728199263750570446964354330903202655824594974439);

        // signature s1
        // forgefmt: disable-next-line
        uint[512] memory tmp_s1 = [uint(12172), 206,12158,234,136,9,130,12124,12273,58,257,12282,2,28,132,12178,25,12217,11913,38,54,12179,12207,12210,26,12086,77,168,373,45,12114,226,164,94,11999,12280,12238,12205,299,12288,12087,12116,121,161,36,12232,12281,14,236,138,12204,12167,11988,12030,185,12225,289,55,12230,48,11970,12055,31,11911,35,200,12085,12234,12187,12281,12270,12178,12233,12169,19,83,136,12202,12258,91,162,224,221,12242,174,218,348,12276,12246,12119,147,12003,121,12107,15,48,12197,12287,12104,279,2,12230,12037,302,91,12189,212,126,12278,12288,24,12124,172,5,12182,146,12143,111,12200,12105,12203,12120,12250,55,12072,11992,12271,12285,29,12218,113,12278,184,98,50,12162,153,12129,42,115,181,12240,327,8,12196,26,12149,217,12210,12287,12195,17,12063,35,12266,12247,59,12083,12195,49,12270,12255,12171,12052,12063,12198,44,208,12238,12033,16,44,127,12120,12226,53,118,201,139,24,12136,12252,222,279,13,310,12253,15,94,12215,108,11957,20,12240,12126,12211,115,12130,81,68,12157,174,109,128,11899,12211,245,70,12245,173,12099,12019,270,396,12112,12127,12026,67,12285,236,118,12196,174,48,12266,12121,12240,12100,73,12182,12196,12132,410,285,12213,12167,12281,70,12128,104,202,12284,12121,12045,138,9,12197,12224,173,12214,372,12020,12249,12233,12068,46,438,12284,12094,190,12165,12225,12084,248,12178,153,14,12237,12093,12231,12088,12166,69,203,201,12142,190,120,131,166,12247,12102,12229,12231,12040,12120,12281,12257,86,11946,12095,12119,233,12189,12272,12106,70,12261,12192,12256,12079,301,12217,12249,12214,36,60,11895,22,137,12256,12138,98,20,200,190,118,11933,159,37,12174,12053,12078,106,320,12223,77,12192,12215,26,12137,12221,9,12129,12127,11,12242,12253,12234,12230,12246,12003,35,11989,11966,218,116,12273,12230,100,12100,147,12097,12216,12184,47,12288,211,12198,12253,26,63,12179,107,39,12231,12191,12091,12222,12282,12196,12095,38,245,127,12274,12211,12229,12211,12180,116,302,12134,12178,11768,95,12221,134,12217,56,504,12259,12245,12072,61,0,12287,12189,163,56,12251,12278,12263,12041,279,241,244,12157,12091,12189,12180,293,12097,20,12221,12247,12195,152,385,320,12045,10,103,194,71,12205,12196,74,152,12076,106,12258,52,12207,47,12056,12279,12270,12243,112,12080,188,146,12067,12224,12275,109,12042,163,55,12141,297,12242,12030,240,40,228,585,53,161,170,12287,109,247,12157,45,12099,54,114,12107,12125,12267,12286,12269,12034,12156,77,108,12136,161,73,111,12117,12093,107,35,22,12245,98,45,29,6,12221,17,12267,12096,11932,252,12269,10,12110,12078,12211,12095,12170,112,243,116,12142,35,178,11889];

        // signature s2
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2 = [uint(12074), 157,12208,12214,12111,280,96,11775,12260,204,132,12014,12206,290,12229,26,12213,82,31,12191,152,188,12103,294,30,12223,130,12126,209,12172,41,12261,11884,12264,270,12085,12140,50,12063,12211,117,94,12082,41,12219,219,0,11990,73,12176,11953,12251,71,42,422,229,454,225,6,25,11988,11,134,6,64,12285,12090,12226,12281,56,40,111,349,12251,12199,241,148,12172,263,103,247,295,436,272,46,12113,29,11980,102,12180,12259,56,12244,0,5,12247,22,22,12212,12200,12097,12238,72,15,12235,11877,19,12106,12254,41,132,323,206,247,167,319,12051,12098,12195,40,104,12248,12255,38,104,318,12176,291,240,4,138,12141,12103,12247,60,12014,164,79,85,12240,182,12219,12260,243,11882,87,64,96,35,12004,202,161,12103,12061,281,12243,413,308,175,12234,64,12281,258,383,52,12271,322,12256,40,43,12172,12254,385,11,138,12244,12193,12287,3,210,164,12155,11972,12136,12124,102,84,12210,12052,12253,349,308,288,12120,12114,12222,12285,12210,131,194,12283,118,12249,12111,12119,12120,201,228,12018,234,11,12026,12247,12073,60,100,76,11853,165,12187,127,12180,12216,56,12014,12255,114,82,12282,221,87,178,12276,12047,120,11955,12135,210,78,12228,123,49,158,12271,12159,145,12134,12273,76,61,48,12142,12171,85,134,244,12015,100,183,167,12150,46,12253,44,12080,12277,12286,87,276,12065,12151,12051,167,136,12263,12167,12234,12084,12182,67,236,223,87,12068,12176,280,12137,12238,12146,138,12026,12247,108,22,6,12103,12237,12267,12186,12086,12125,201,11984,12028,12183,12168,98,438,12063,126,68,12124,12259,12242,12247,12185,12110,17,22,352,76,12242,410,12263,118,3,239,307,12256,12137,23,84,174,52,12229,12124,12,12280,134,152,74,196,144,12231,110,149,12137,12264,315,234,180,12077,12103,12229,12124,12172,55,323,12070,41,12171,144,30,12085,11996,32,133,8,34,148,166,12243,93,310,244,12287,126,12037,12093,54,12279,112,12156,12133,33,250,12115,167,2,11954,174,12008,12118,12203,137,100,238,12228,1,12145,44,221,59,9,137,13,12169,144,37,103,1,293,46,324,58,168,12069,16,12153,12130,186,12162,53,11906,64,52,100,12211,321,45,12266,117,110,12069,119,12136,12192,94,54,12251,12175,12288,12133,12164,12069,12053,177,94,12247,109,12287,12191,112,12086,0,12244,1,66,14,237,29,178,7,12061,99,12242,12170,101,35,122,208,70,12174,12000,12132,12203,12288,12082,12111,12118,84,255,156,12257,12019,11883,12176,61,164,370,117,62,12068,12233,22,12247,12007,12065,79,12010,170,11989,406,73,12086,12158,12246,12228,12238,78,12021,137];

        ZKNOX_falcon_epervier.Signature memory sig;
        // signature s2 inverse ntt
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2_inv_ntt = [uint(10065), 5011,4049,1691,3264,10554,8356,7068,9615,9048,2488,8852,12160,102,10912,10079,167,5373,308,3624,6726,13,6541,5864,10747,10481,3946,4360,1586,10369,4141,328,10185,7840,11844,1045,344,225,8757,7735,2765,5389,3198,1489,10905,10377,6195,8682,3262,11889,7197,9584,2629,10049,2290,8629,5155,11429,9425,9563,7164,1835,5218,6568,9358,10888,7315,1265,912,3719,6284,6154,10004,6218,7635,11497,10569,10763,7674,2637,4002,4503,5441,8542,1349,6331,2676,4503,4841,11928,10308,11599,5479,5174,1357,11735,6066,8017,1404,7692,9933,2619,3044,259,6821,10489,2043,6207,11047,7943,6312,9136,10338,9247,5288,6543,8996,5998,4644,10975,6799,5901,4503,9630,11669,1943,7112,9695,11330,6264,4093,10236,11435,1732,10379,8774,9464,9275,6732,11078,1678,6893,11090,4522,3975,631,49,9386,10474,12107,4967,10489,7522,5804,6035,5287,1497,11045,8253,9324,9905,3455,11547,506,8247,2637,5285,7664,1500,4802,2378,1705,5083,887,1605,3004,12126,5960,8836,1283,4016,872,8145,7113,7576,5292,8234,4345,9162,10706,11159,8457,190,2607,9874,6754,6835,422,754,9331,2373,11224,3794,8209,7166,8882,11239,10076,5453,10404,1822,7588,3904,9297,6412,8416,2045,2565,6446,10048,7727,966,1615,255,2645,7801,5342,1329,5404,7022,11237,3115,9708,8411,4930,1877,6292,10166,9339,460,8358,2179,8742,3854,11600,7874,10370,10180,3466,1277,2229,7441,7640,7338,1810,10697,6965,10004,3374,7612,6879,8792,3207,2382,2330,9068,7310,10055,10817,8747,11066,5130,10419,7436,11757,2490,1264,5922,1572,10933,4841,11998,7181,992,252,1277,11998,7204,6569,9406,5835,3988,7895,3621,6952,3359,7234,8494,8590,2258,11019,10344,514,424,1615,1395,1296,9836,10980,11428,10682,3368,9427,1319,11794,2314,10794,6654,2940,4173,1945,2582,3426,3005,8705,8535,11540,2186,10817,3244,6356,11135,6357,2517,9714,5777,2615,3957,81,7089,5379,1514,7229,169,10949,7618,5654,3472,7937,7390,2241,8919,4295,2494,1099,10276,6181,10862,4141,10973,7799,3020,10669,9007,4301,6826,10607,365,1609,4651,5860,7675,9455,1200,5630,5247,11538,2647,1709,5782,5998,956,1396,4476,8020,2025,11397,5831,6851,5577,4577,10592,9742,1593,5037,1020,5325,322,8474,5188,5338,11043,9720,1279,4679,8159,2544,192,2815,9257,2205,7436,6653,10187,363,9025,1759,10301,6769,824,3766,3149,10563,2464,5085,4787,359,11046,2947,5924,9670,4841,1492,8119,3420,7847,12244,6496,5210,4774,5394,3251,11300,3775,9795,9848,3239,11718,2302,6282,1849,1294,9312,6070,4027,25,10447,612,7548,2890,1281,2940,3556,4287,10191,2568,6994,11194,7916,3053,5525,4795,5395,3959,639,5322,414,10273,8041,8192,10050,7895,7232,3158,6648,1598,1232,772,10896,9678,9518,4617,9664,10580,8520,3183,12126,6310,9464,10174,6513,5666,9616,9057,11822,2454,11491,9521,9201,8597,8333,10023];
        for (uint256 i = 0; i < 512; i++) {
            sig.s1[i] = tmp_s1[i];
            sig.s2[i] = tmp_s2[i];
            sig.hint[i] = tmp_s2_inv_ntt[i];
        }
        // message
        bytes memory message = "My name is Nicolas";
        sig.salt =
            "\x13\x57\x9b\x4e\xf5\xf6\xb6\x42\x65\x63\xd7\x19\x5b\x8c\x5b\x84\x73\x6b\x14\x26\x61\x60\x34\x2c\x40\x93\xf8\xab\xea\x48\x37\x1b\xa9\x4c\xc0\x6d\xcb\x6b\x8a\x8e";
        address recovered_pk_2;
        recovered_pk_2 = epervier.recover(message, sig, false);
        assertEq(pk_2, recovered_pk_2);
    }

    function testVector3() public view {
        // public key
        // forgefmt: disable-next-line
        address pk_3 = address(728199263750570446964354330903202655824594974439);

        // signature s1
        // forgefmt: disable-next-line
        uint[512] memory tmp_s1 = [uint(12157), 12018,33,141,12117,248,12155,12152,174,9,35,203,54,236,11979,11999,12214,199,30,12223,93,161,12218,12095,12190,317,12273,12267,103,12199,12277,285,104,39,54,87,12218,152,12212,12239,12180,12163,12187,12182,12047,12110,152,77,12063,30,12040,12226,12286,12238,84,12284,139,12261,12003,12225,121,164,219,3,12252,12123,12056,12174,12235,176,88,12144,12230,31,12261,6,12238,419,53,12217,12124,12040,207,12223,12143,292,12080,212,12214,11,36,7,12069,12082,22,12048,27,12207,12160,12166,174,12278,93,12180,237,87,12170,12061,38,12166,10,275,111,103,12257,12223,12281,12201,170,133,12180,12152,278,12071,292,241,11957,31,4,12054,321,11835,43,376,130,12095,12110,142,323,17,12209,40,128,12277,12088,12247,12181,12279,12260,195,12221,47,74,12141,12064,12122,12246,11985,156,98,124,12186,12242,12215,89,110,12138,129,249,11999,12121,32,12169,85,314,181,12198,36,12113,12265,372,127,157,12277,12166,12250,12226,34,12243,37,12163,208,12181,11987,226,12063,102,183,21,12088,12276,12243,12217,67,113,12264,12009,12210,12241,211,50,167,12260,30,12245,12216,12118,135,12160,12261,37,114,12129,12214,12085,59,12238,262,12185,5,12182,291,6,12232,12080,202,89,12188,12054,12126,12282,403,143,12272,61,12057,12101,12175,12208,12184,106,12009,159,245,200,32,56,12044,92,12239,12149,24,12257,109,12089,12286,11,21,12244,12174,16,29,12137,193,171,12051,12130,114,12090,8,12223,191,12255,12168,12157,158,277,12139,150,152,12206,41,3,253,3,12207,11996,55,142,12267,61,12116,117,12180,12103,12029,12048,12103,56,12274,148,66,22,95,12238,75,12249,87,62,20,12139,47,12198,12287,12134,12226,12275,147,108,12186,111,53,12260,12228,5,12250,73,12273,12133,65,151,12255,24,90,155,142,12094,266,192,12119,15,12041,12252,41,11957,12106,12269,135,169,156,164,11967,91,42,12157,22,12199,12118,70,84,271,167,12254,32,12212,33,12071,60,151,21,12076,109,12269,210,255,12264,172,12130,202,119,143,12204,11992,12247,12053,10,121,115,71,12123,12173,12146,12187,12256,28,171,27,12204,131,138,12029,12193,182,12276,12043,8,168,12278,12167,99,88,12217,166,168,86,37,215,34,12120,12191,12232,12131,12101,12023,12027,12242,12273,12065,78,12268,55,257,31,63,305,233,12016,12178,12211,12213,88,86,12106,12232,11989,105,12262,17,12235,93,171,109,12,12122,12099,12146,12014,12023,12159,95,80,12247,100,169,12169,12163,99,36,35,4,12133,12079,35,12052,73,276,268,193,12256,143,12134,47,12281,12169,105,92,83,12162,12203,12116,36,12130,12288,12021,12125,260,12214,12258,86,12133,78,138];

        // signature s2
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2 = [uint(394), 103,208,244,12166,12270,12258,12098,12180,12287,12276,71,91,12258,167,78,12233,38,149,12237,170,146,12235,377,393,17,12005,12194,63,72,12211,12172,139,12112,52,12275,87,38,12032,153,12168,223,12243,26,11961,12278,12287,12153,12253,12060,12205,12110,217,12123,12174,12213,264,12118,12159,12172,12104,12193,245,28,12175,12092,86,12030,227,11976,12210,102,12040,12030,0,254,50,45,302,12004,217,36,12075,11,42,11935,12179,293,12255,67,12105,12070,118,12235,12023,12234,12161,12126,281,22,12062,77,206,201,12154,7,177,127,53,12266,60,45,104,12159,12047,122,12226,12225,320,319,9,12182,12252,157,12285,268,8,88,12267,12255,123,46,240,12024,232,145,12047,66,12160,12267,155,269,12230,60,12285,11871,12194,78,12192,255,11909,12257,12191,12201,91,279,12126,12204,15,131,12240,12159,11953,12248,12180,12272,89,66,161,12218,12136,257,238,101,110,12236,12210,12249,12225,21,41,12151,101,182,102,12246,100,15,12227,12152,100,206,12265,12286,192,150,12248,12202,34,280,12034,268,15,47,133,42,12250,12055,314,12161,12165,309,12232,12095,231,115,207,61,12189,107,12144,12153,217,44,12048,12264,12011,281,103,157,12123,12006,5,12100,108,12223,52,86,56,21,12283,12175,16,12165,12200,12078,54,12237,202,118,12173,148,135,12196,104,194,12208,52,87,12112,29,4,12265,268,100,199,247,12263,26,12249,12258,125,12284,12156,12090,12135,12239,12254,44,12279,12162,12219,12147,190,12286,12096,12203,12169,395,287,131,12257,12086,6,12109,11,132,56,12167,298,12253,12248,153,140,12217,12172,107,12178,12135,12280,12213,12271,12258,12271,12277,164,12153,72,11941,12208,12202,121,12151,12281,52,72,12082,12212,12224,21,160,166,50,158,12085,12257,12283,11859,12070,12147,12161,12201,2,121,221,11988,12266,245,150,123,284,10,207,124,12090,12150,12265,12241,199,237,90,12134,130,82,12007,208,12133,88,164,42,343,268,101,12190,63,11937,10,42,49,175,12184,12120,42,12170,12238,173,30,22,154,151,53,12266,126,167,12191,12252,12208,12148,157,63,148,12025,7,12219,12166,103,12242,12077,12004,12269,13,44,12021,245,12057,12037,168,0,12186,250,12278,12254,12209,114,313,12108,12266,12125,45,123,69,12100,111,41,28,157,13,130,12216,12169,173,12086,178,12148,96,30,12118,238,12051,12098,109,30,69,203,81,84,54,36,12276,12271,93,12259,391,12252,12215,12020,68,77,11969,4,12260,198,12061,279,81,12195,10,291,12064,13,185,12235,125,12208,215,12138,78,16,32,12279,352,12266,38,118,12116,112,12248,126,11886,21,12096,45,76,12100,127,12057,12219,38,7,12054,12209,183];

        ZKNOX_falcon_epervier.Signature memory sig;
        // signature s2 inverse ntt
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2_inv_ntt = [uint(411), 10133,10203,2084,7183,1085,5672,8416,2654,925,671,11288,3410,4448,1246,5496,10915,8410,11004,7128,36,9365,1629,5057,960,7493,3179,1217,5731,10539,5128,7544,1581,9418,6739,2013,421,9836,10198,7568,3999,3143,11789,4975,7646,11305,4438,1795,10467,3132,8701,7156,11690,9226,8239,11093,9991,6286,10258,8106,11524,2757,59,7615,10914,6643,11489,12188,4147,6167,1371,11838,758,2465,5884,4155,9628,10622,11499,3247,3660,9337,2134,5693,11643,5814,8159,3407,568,8605,4609,1179,379,6187,11694,9097,6914,408,1897,2212,4815,9887,6733,2189,2957,3030,8613,8291,4784,2408,7492,8438,10684,12180,1267,10032,10453,2121,10381,8205,8905,5797,7232,3717,3728,5384,11059,525,8848,7893,620,1632,3666,887,1627,4490,11697,11064,11701,509,11324,9863,8562,3463,10834,7448,3186,3919,149,3692,9488,7133,4008,2986,3227,3071,1678,10572,7002,11604,9319,2467,5264,11146,10225,3168,486,8840,12097,3324,6167,1226,11191,8057,1311,9591,2398,1775,1204,694,9148,5324,1891,8728,3882,11129,3261,6155,2542,6247,4405,1761,9062,10133,4622,7924,7236,9324,9053,4586,5825,11692,10282,4736,9672,10677,3682,6769,8145,5777,6129,7401,1952,3369,4065,7632,6192,7767,10360,12111,3377,4871,1519,5219,3083,6858,12089,6687,1404,6583,1124,9920,5184,5934,335,4776,4101,5912,4492,9153,1518,10339,8110,8546,9828,6787,4629,10549,9693,1221,5631,8841,10877,88,9245,2200,4468,6998,7320,90,3242,12078,11110,9144,5476,9998,7379,4689,11492,7779,4981,9153,670,9508,7861,8994,11670,8018,4418,5260,9662,1237,12286,5732,11703,2472,7977,11764,5156,5334,9203,4410,8979,10528,9328,3397,11623,1983,3202,7749,3830,11302,11807,8976,1840,10986,8229,8881,11754,9426,4899,7554,11307,3009,2549,1494,392,4798,5974,11034,11066,113,2659,3062,3064,415,3538,3804,12083,1804,11225,6800,9572,3578,9389,7665,11496,10545,502,4553,7403,1069,2704,11094,4154,8143,678,8173,7309,1234,9784,1993,3900,3816,3043,6979,11140,4592,8384,7873,868,9023,7771,4413,1471,3539,10280,1482,73,7716,1193,5818,8077,9106,6905,2731,6513,5415,10026,1826,3881,10240,1169,10602,11858,3764,4702,7424,4954,6898,8726,10708,5162,10429,9140,10280,1634,5840,10172,1881,483,9230,3855,8179,7282,533,144,1533,6547,1382,1664,4956,3995,11952,2938,10905,7904,3568,10535,8931,804,9877,564,6966,2226,4712,2682,114,4305,7875,9354,5710,1074,6272,3550,5136,2644,2903,4012,11240,5931,1894,3651,11390,1953,2944,4704,9959,1089,1141,5186,10489,1354,10895,12265,7163,5425,1627,1000,5644,5813,10351,2891,9413,11479,3399,588,5751,6238,397,1132,2479,8326,12083,7902,742,4055,878,11282,7827,12272,5105,4617,8812,10132,3451,11558,2072,7375,1625,9079,11210,11902,5615,110,11776,10904,9942,6846,2769,7294,11356,2615,2903,5687,10851,3150,2320,2877,11573,11282,4653];
        for (uint256 i = 0; i < 512; i++) {
            sig.s1[i] = tmp_s1[i];
            sig.s2[i] = tmp_s2[i];
            sig.hint[i] = tmp_s2_inv_ntt[i];
        }
        // message
        bytes memory message = "We are ZKNox";
        sig.salt =
            "\x5a\x54\x83\x5f\x8b\x04\xd4\xc0\xb2\x96\x67\xba\xeb\x0c\x32\x58\x80\x9e\xe6\x98\xdb\xc0\x35\x36\xa1\xc9\x36\xc8\x11\xf6\xe6\xf6\x92\x10\xf5\x63\x20\x80\x06\x49";
        address recovered_pk_3;
        recovered_pk_3 = epervier.recover(message, sig, false);
        assertEq(pk_3, recovered_pk_3);
    }

    function testVector4() public view {
        // public key
        // forgefmt: disable-next-line
        address pk_4 = address(728199263750570446964354330903202655824594974439);

        // signature s1
        // forgefmt: disable-next-line
        uint[512] memory tmp_s1 = [uint(12211), 12271,315,12246,12048,50,12234,12150,139,12157,12175,213,130,239,38,12213,144,12244,12268,12198,12232,102,154,12256,126,52,38,12276,6,86,11991,69,12263,12280,636,139,12262,12183,12194,12285,12259,185,12101,12119,170,44,88,12120,12225,278,183,11909,9,12158,12262,96,26,12086,153,12261,12208,15,12154,190,12121,11991,185,119,12148,12283,12216,12199,338,12070,12034,12075,40,44,184,12198,26,12107,12172,154,20,79,12259,69,218,12053,424,95,238,12124,12209,12220,28,12129,12118,139,200,12188,205,12282,11911,12284,12083,301,113,92,12205,195,62,12156,11991,203,11996,24,149,236,12147,194,215,12256,246,12052,90,12018,107,12070,187,12067,73,12272,12099,272,177,87,12249,12194,12123,197,171,198,12209,24,179,12243,249,84,12046,12258,12014,144,12164,130,12058,12255,52,12064,12162,125,12176,12072,21,12253,12095,12193,12154,12274,110,59,87,163,92,53,12233,108,120,12285,176,12223,12257,12211,70,12102,12279,12286,178,12193,443,12183,12208,11965,12088,74,382,331,12180,12234,141,59,12004,12202,12262,12090,234,12,128,42,11933,12147,47,12236,12135,12284,2,12160,12045,219,12184,102,11,12255,7,151,12237,91,12233,12099,12288,12222,12172,12077,150,93,45,208,13,11,120,299,12256,275,12090,82,12093,12182,12087,21,168,12241,36,11930,20,12126,62,12063,12244,95,12211,12011,12250,328,12179,34,137,273,12167,12106,171,12204,114,12185,17,12076,12183,12008,49,60,12256,12110,12087,12288,12135,82,257,11922,73,125,12252,12186,50,106,151,12146,12147,12285,59,13,7,0,11951,11857,133,12265,85,12150,12164,12153,25,74,121,128,12149,12117,71,12240,50,12250,307,12206,143,12064,12226,37,12230,42,12280,14,12086,212,12287,149,12058,12230,124,225,12174,28,12091,257,12216,379,161,82,7,12107,130,15,288,268,12284,38,12167,12003,184,12243,12207,46,12209,12230,12275,12173,12,12225,74,117,157,12210,259,55,12055,12284,12185,129,0,12277,12052,252,12014,12128,12237,12173,12180,12147,12282,12214,0,12276,267,12214,38,97,165,151,12215,61,8,56,33,275,12247,164,34,267,12205,219,11955,12208,262,58,12233,12266,88,11,12277,3,12229,87,12181,12183,18,39,212,12172,12077,12226,11962,11981,12231,207,135,292,97,12079,112,12211,31,30,69,12164,12253,38,202,12182,12258,12275,140,132,11,12159,131,12182,12158,243,262,12189,12033,12194,164,8,12273,63,352,293,86,12035,12270,207,12113,411,269,169,12189,77,12276,12169,144,52,12276,12271,98,386,12174,252,127,12198,11932,23,12041,214,12245,12260,494,67,53,170,12164,12240,12144,12150,36,13,57,12045,39,12250,134,12166,12134,32];

        // signature s2
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2 = [uint(90), 12285,12152,12163,12276,12034,29,12066,12251,166,118,48,117,18,26,12220,12248,144,12212,12210,90,12164,117,29,161,140,135,12154,294,328,12036,193,12147,104,21,73,12099,326,11945,12221,12219,12193,36,324,6,11990,12288,12075,12228,12214,12236,12238,90,110,207,12126,12172,12257,188,146,12104,385,73,12219,10,12178,174,211,12285,121,12247,186,12234,95,300,100,206,178,12154,274,12166,12075,12179,11950,372,12233,12101,12132,45,12147,31,167,12122,179,5,12213,12208,12040,12281,279,12160,11926,12227,12131,56,12228,1,12265,56,12224,12242,12277,307,12161,12256,402,25,11990,157,12256,134,12264,12158,12272,12012,12268,12214,22,12216,12027,12070,289,119,45,12268,12112,340,12099,11987,40,16,250,158,153,206,60,12137,13,401,12167,104,406,12171,12196,12135,12148,71,12260,12210,12157,12079,120,11916,12240,12089,12200,99,12097,118,7,12250,301,12277,150,148,64,12234,12117,11997,12275,120,131,12030,12101,12191,163,12179,11953,12230,118,19,135,61,12157,41,319,12107,12239,268,12216,69,423,50,200,173,173,89,113,165,12257,128,299,271,12229,12201,133,12065,12150,12070,144,86,12122,12204,12151,12132,12261,395,12275,12058,122,153,12202,245,12035,12198,181,12022,12222,12173,12111,180,264,12062,4,11876,138,166,209,271,12196,138,12119,12017,12269,110,12231,11857,12197,12220,41,12042,12086,66,11,11996,12215,11963,12287,12277,161,12204,79,112,317,42,11846,12277,67,12182,12134,89,186,17,6,12208,128,98,12080,12168,202,103,79,12193,85,12175,12156,12168,11971,12162,12015,6,57,12081,255,12117,12192,25,12040,111,12197,138,351,12168,266,12193,166,12223,12272,147,12218,65,12266,96,30,11993,12141,241,12174,89,12208,12280,12082,116,11912,14,12089,47,23,10,12263,12246,90,12267,8,313,12223,12046,135,11924,122,29,12172,52,18,278,12185,225,12137,12179,16,12081,12102,116,12143,12011,12219,12251,81,12214,12087,12286,12145,241,12175,12250,12224,127,183,12204,21,53,11995,274,163,12252,294,185,12210,128,310,78,70,356,11957,85,219,83,11959,12103,3,12140,300,12195,12027,12272,44,208,12160,209,12171,225,12220,29,231,12281,85,106,12154,12211,12287,90,22,12085,11988,12204,20,12121,282,12235,25,163,12268,12007,12139,12243,12230,12055,125,297,88,12116,105,38,12267,12244,12249,12100,56,211,90,12133,12012,12099,12092,12236,176,12231,12060,65,90,12216,12265,11989,12158,82,12266,12200,58,48,12258,18,12058,11991,12226,12184,11968,199,12236,12273,63,12142,105,12012,119,12233,12275,12228,7,25,12236,12115,12126,12262,12253,12135,90,95,12251,22,12265,12033,12229,12284,12224,12139,12237,12231,167,12227,47,12276,233];

        ZKNOX_falcon_epervier.Signature memory sig;
        // signature s2 inverse ntt
        // forgefmt: disable-next-line
        uint[512] memory tmp_s2_inv_ntt = [uint(2859), 1743,500,7966,3142,3457,9718,885,12003,8313,11665,1672,7369,1358,3484,10914,4602,10349,11494,4972,4776,4883,8849,7657,11548,7347,10923,9946,12047,3664,4566,7729,11436,7613,409,9231,11858,8452,5115,2226,6395,11706,12092,10416,6399,10892,3177,5494,10112,9371,5589,389,7720,5765,3819,9363,10248,1235,10642,3166,1276,11023,8178,11265,3803,6588,11207,208,1280,7578,3273,10226,403,9478,9853,3432,4270,8689,2015,1187,620,11208,12156,917,5467,11821,2277,2630,1454,349,11121,5081,8502,6472,7030,5024,8283,7997,3186,462,1964,4798,1959,621,7018,7515,854,4979,3257,1638,10003,4985,8681,478,268,2312,10674,4901,1456,6208,12252,8912,4133,10178,9828,488,5611,5158,4079,8124,7091,1309,6610,6858,10248,7594,123,9744,1922,10956,9438,7777,2583,9384,5089,10826,3318,3155,10145,6537,3908,961,8912,5562,12020,10407,2255,1846,7214,8335,3343,3469,9279,4908,1160,592,9789,2146,875,10400,8614,1723,7317,3502,4291,7554,10795,9096,9226,11530,6996,12237,3460,9154,10974,5175,1254,5410,2102,5751,10105,8574,8012,8299,3815,224,3246,6061,1047,6050,3864,11464,11816,4405,6560,7925,5795,10327,7220,7886,5275,334,5870,6681,11386,10974,12138,944,2940,9998,3359,7998,10858,4130,6123,5172,7109,5002,3376,1573,6739,8928,3974,7913,5037,2025,8085,4170,1172,5204,10876,9823,3073,5941,8209,3494,193,4937,10413,11251,7866,3864,3376,2060,288,625,4310,3526,10956,1894,3255,10143,4112,7590,8311,7416,5441,12239,6865,9180,9795,1959,10988,2631,4087,3960,5961,6677,3106,3015,5626,10993,2501,9412,6996,5394,2646,7832,8598,11985,739,11608,5622,8794,1988,11661,8915,7190,2237,5183,9728,6638,1244,982,10678,7538,1348,545,4277,3729,6139,737,7373,2410,3348,7756,2464,3627,8728,2356,812,3019,2682,4807,7376,2595,12288,4252,9295,8028,6078,307,8825,11825,701,10916,7794,273,7367,6356,6243,3909,11354,1406,10792,8397,10552,2357,2813,5588,76,2573,3992,11150,11360,5387,5216,5182,10685,10383,3169,12170,4124,8667,3880,5029,134,2806,3854,2612,7196,4334,3018,10957,5310,8308,317,12250,4711,11342,8609,8047,2058,230,11281,1547,10687,10714,769,12274,681,6411,3008,2981,3624,6944,1087,9918,2576,4112,9156,135,7684,7243,9323,2671,7396,8449,5636,10198,5374,1393,8516,1424,9306,9795,806,7448,2831,6451,2223,9118,2400,8238,1910,3713,6524,771,388,3710,8430,12139,9579,3645,7284,25,10944,1066,2608,11890,12016,11070,9928,1695,3985,6986,12104,994,11860,6900,10184,689,10890,6653,3875,1081,5531,1822,11142,5973,1960,11431,2395,1206,9185,1546,6374,10762,11413,5556,3594,7019,4558,8388,5292,372,2386,10032,11015,9137,205,1432,3213,5339,647,3429,3068,1673,6285,4416,2099,4900,2878,4642,3321,9711,7669,3235,6515,3829,10453,9236,4395,10651,3095,9965,857,11357,3757,4279,4726,2941];
        for (uint256 i = 0; i < 512; i++) {
            sig.s1[i] = tmp_s1[i];
            sig.s2[i] = tmp_s2[i];
            sig.hint[i] = tmp_s2_inv_ntt[i];
        }
        // message
        bytes memory message = "Practical security on the chain.";
        sig.salt =
            "\xc3\xff\x24\xbc\x6b\x6d\x7a\x3d\x30\x7c\xe7\xb1\x73\x1e\x7d\xf5\x96\x90\xd0\x53\x0d\x7f\x2f\x5b\xb9\xed\x37\xd1\x80\x16\x9a\x6c\x1b\xb0\x22\x25\x2a\xb8\xcc\x68";
        address recovered_pk_4;
        recovered_pk_4 = epervier.recover(message, sig, false);
        assertEq(pk_4, recovered_pk_4);
    }
}
